{# TEMPLATE: funnel — Progressive narrowing funnel with stage labels and annotations. #}
{% from "slides/_section-attrs.njk" import sectionAttrs %}
<section class="slide-funnel"{{ sectionAttrs(slide) }}>
  <div class="slide-body">
    <div class="slide-header">
      <h2>{{ slide.title }}</h2>
    </div>
    <div class="funnel-wrapper">
      <div class="funnel-grid">
        {% for stage in slide.stages %}
        <div class="funnel-row{% if slide.fragment %} fragment {{ slide.fragment }}{% endif %}">
          <div class="funnel-stage-wrapper">
            <div class="funnel-stage stage-{{ loop.index }}">
              <span class="stage-label">{{ stage.label }}</span>
            </div>
          </div>
          <div class="funnel-annotation">
            <span class="annotation-arrow">→</span>
            <span class="annotation-text">{{ stage.text }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% if slide.notes %}<aside class="notes">{{ slide.notes }}</aside>{% endif %}
  </div>
  {% if global_footer and not slide.hide_footer %}
  {% set reference = slide.reference %}
  {% set reference_link = slide.reference_link %}
  {% set references = slide.references %}
  {% include "slides/footer.njk" %}
  {% endif %}
</section>
